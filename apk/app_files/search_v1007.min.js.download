"use strict";$(function(){var s="apkpure.search.history:v1";$(".search-mask").click(function(){$("#nav_new").addClass("searching"),setTimeout(function(){$("#nav_new .search .autocomplete").focus()})}),$(".autocomplete").focus(function(){$(this).val()||$(".search-history").show()}).on("input",function(){$(this).val()?$(".search-history").hide():$(".search-history").show()}),$(document).click(function(e){var a=$(".search-input, .search-history, .search-mask");a.is(e.target)||a.has(e.target).length||$(e.target).hasClass("search-history-item-delete")||$(e.target).hasClass("icon-search-history-item-delete")||($(".search-history").hide(),$("#nav_new").removeClass("searching"))}),$(".search-history").on("click",".search-history-item-delete",function(){var e=$(this),a=e.parents("li").index(),t=window.localStorage.getItem(s);if(t)try{if(t=JSON.parse(t),!$.isArray(t))throw new Error;t.splice(a,1),window.localStorage.setItem(s,JSON.stringify(t)),e.parents("li").remove(),t.length||$(".search-history").remove()}catch(e){window.localStorage.removeItem(s)}}).on("click",".search-history-delete",function(){$(".search-history").remove(),window.localStorage.removeItem(s)}),$(".clear-input").click(function(){$(this).parents(".formsearch").find(".autocomplete").typeahead("val",""),setTimeout(function(){$("#nav_new .search .autocomplete").focus()})});var e=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("key"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:"".concat($(".formsearch").data("x_ll")||"","/api/v1/search_suggestion_new?key=%QUERY&limit=20"),wildcard:"%QUERY"}});$(".formsearch").each(function(){var n=$(this);n.find(".autocomplete").typeahead({highlight:!0,minLength:1},{displayKey:"key",source:e,limit:20,templates:{suggestion:function(e,a){var t=e||{},n=t.search_suggestion_id||"",o=t.isIntervene,c=t.isInterveneUrl;if(window.setElementDtParams&&window.setElementDtParams(".tt-menu",{search_input_keyword:t._query,search_request_keyword:t._query,search_id:n,h5_exp_id:+$("#header").data("search-sug-download")?10011:""}),t.packageName){var s="h5_exp_id=".concat(t.showDownloadBtn?10011:"","&search_input_keyword=").concat(t._query,"&search_request_keyword=").concat(t._query,"&search_type=tips_app_search&search_id=").concat(n,"&operational_configuration_type=").concat(o?"1":"2","&small_position=").concat(+a+1,"&package_name=").concat(t.packageName),r=c?"a":"div",i=c?'href="'+t.fullUrl+'"':"",d="";t.isTv&&(d+='<span class="corner-tag-icon tv">TV</span>'),t.cornerTags&&t.cornerTags.length&&t.cornerTags.forEach(function(e){d+='<span class="corner-tag-icon">'.concat(e,"</span>")});var l=d?'<span class="floatr fr corner-tag-icon-box">'.concat(d,"</span>"):"",h=t.isIntervene?'<div class="da" dt-eid="download_button" dt-imp-end-ignore="true" dt-send-beacon="true">'.concat(t.buttonText,"</div>"):"",u=t.showDownloadBtn?'\n                  <a\n                    class="da normal-download"\n                    href="'.concat(t.fullDownloadUrl,'"\n                    title="').concat(t.downloadTip,'"\n                    data-dt-app="').concat(t.packageName,'"\n                    data-dt-apkid="').concat(t.fileId,'"\n                    data-dt-version="').concat(t.version,'"\n                    data-dt-version-code="').concat(t.versionCode,'"\n                    data-dt-file-size="').concat(t.fileSize,'"\n                  >').concat(t.downloadText,"</a>\n                "):"";return"\n                  <".concat(r,'\n                    class="search-package"\n                    dt-eid="app"\n                    ').concat(i,'\n                    dt-imp-end-ignore="true"\n                    dt-send-beacon="true"\n                    dt-params="').concat(s,'"\n                    data-dt-intervene="').concat(o,'"\n                    data-dt-interveneUrl="').concat(c,'"\n                    data-dt-key="').concat(t.key,'"\n                    data-dt-query="').concat(t._query,'"\n                    data-dt-suggestion-id="').concat(n,'"\n                  >\n                    <div class="package-info">\n                      <img class="icon" src="').concat(t.icon,'">\n                      <div class="info">\n                        <div class="info-title">').concat(l).concat(t.title,'</div>\n                        <div class="info-intro">\n                          <span class="score" data-score="').concat(t.score,'"><span>').concat(t.score,'</span></span>\n                          <span class="score-total">').concat(t.scoreTotal,'</span>\n                          <span class="install-total">').concat(t.installTotal,"</span>\n                        </div>\n                      </div>\n                    </div>\n                    ").concat(c?h:u,"\n                  </").concat(r,">\n                ")}var p="h5_exp_id=".concat(t.showDownloadBtn?10011:"","&search_input_keyword=").concat(t._query,"&search_request_keyword=").concat(t._query,"&search_type=tips_keyword_search&search_id=").concat(n,"&operational_configuration_type=").concat(o?"1":"2","&small_position=").concat(+a+1,"&tips_search_keyword=").concat(t.key);return'<a class="search-key-word" href="javascript:void(0)" dt-imp-end-ignore="true" dt-eid="search_result_list_keyword" dt-params="'.concat(p,'" data-dt-intervene="').concat(o,'" data-dt-key="').concat(t.key,'" data-dt-query="').concat(t._query,'" data-dt-suggestion-id="').concat(n,'">').concat(t.key,"</a>")}}}).on("typeahead:selected",function(e,a,t){a&&a.packageName&&(a.isInterveneUrl||a.showDownloadBtn)||n.submit()}).on("typeahead:active",function(e,a,t){window._dt_event_bus&&window._dt_event_bus.emit&&window._dt_event_bus.emit("dt_suggestion_ready")}).on("input",function(){$(this).val()?$(".clear-input").show():$(".clear-input").hide()})}),function(){if(window.localStorage){var e=window.localStorage.getItem(s);if(!e)return $(".search-history").remove();try{if(e=JSON.parse(e),!$.isArray(e)||!e.length)throw new Error;for(var a=$(".search-history-list"),t=a.attr("data-path"),n=$(document.createDocumentFragment()),o=0;o<e.length;o++){var c=encodeURIComponent(e[o]);n.append('<li>\n          <a class="search-history-item" href="'.concat(t,"?q=").concat(c,'">\n            <div>\n                <i class="search-icon-time"></i>\n                <span class="content">').concat(e[o],'</span>\n            </div>\n          </a>\n          <span class="search-history-item-delete">\n            <i class="icon-search-history-item-delete"></i>\n          </span>\n        </li>'))}a.append(n)}catch(e){$(".search-history").remove(),window.localStorage.removeItem(s)}window._dt_event_bus&&window._dt_event_bus.emit&&window._dt_event_bus.emit("search-history-lazy-loaded")}}()});